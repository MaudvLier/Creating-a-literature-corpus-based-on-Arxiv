LLM A\*: Human in the Loop Large Language Models Enabled A\* Search for Robotics


INTRODUCTION


Path planning together with mapping, localisation, and motion planning has long been considered the cornerstone techniques to enable full autonomous agents such as robots [*REF*; *REF*; *REF*]. Path planning usually takes the environment map, the initial and goal states as inputs and aims to find the (near) optimal path in terms of action cost to move the agent from the initial state to the goal state. A variety of path planning approaches have been proposed and they can be categorised into 1) search-based algorithms such as the classical A\* search which is guaranteed to find an optimal path when heuristics are admissible and consistent; 2) sampling-based planning such as the Rapidly-exploring Random Tree (RRT) [*REF*] and Ant Colony Optimisation (ACO) [*REF*], etc.; and 3) Data-driven planning such as neural A\* [*REF*] and Reinforcement Learning (RL) based search [*REF*].


RL is one of the most renowned data-driven planning methods. In a nutshell, RL achieves path planning through trial and error, i.e., when in state *MATH*, an agent will evaluate rewards it can get from performing a certain action *MATH* and choose the action with the best rewards to perform. This helps the agent to learn a &apos;good&apos; policy that generates an obstacle-free path from the initial state to the goal state. A variety of policies have been proposed [*REF*] and the Proximal Policy Optimisation (PPO) is among these that achieve a balance between convergence efficiency and stability [*REF*].


While industries and academia are exhilarated by the performance of data-driven planning, they remain coding-heavy and black boxes as they are mostly underpinned by deep neural networks. We believe that techniques should eventually improve human well-being, and accordingly, humans, especially normal civilians should be granted access to the underlying mechanisms of such techniques, to control or even terminate certain services whenever and wherever necessary.


The recent advancements in LLMs have made an &apos;overhaul of data-driven techniques&apos; possible. LLMs are capable of human-like text generation and task completion [*REF*]. The texts generated by LLMs constantly show that they can deal with commonsense information well to a human-like level, especially in a chain-of-prompts manner where humans can enforce/teach LLMs to find the answers in demand. This resembles RL apart from the rewards are assessed and granted by humans through interaction with LLMs. All these have partially distanced people from questioning the explainability of LLMs&apos; horsepower, i.e., the &apos;transformer&apos;, which is a deep neural network itself and focused more on the models&apos; ability to &apos;answer a question&apos; in each prompt.


This paper harnesses the advantages of A\* being able to find an optimal path and LLMs being able to consider commonsense knowledge when interacting with humans (agents) and proposes the LLM A\* for robot path planning.


Briefly, LLM A\* can be summarised into three crucial stages. This first stage is to set up the workspace where a robot performs path planning.
An environment model and how it will be used by the robot will be communicated to LLMs. The second stage entails the description of the initial state, the goal state, and the heuristics to be used. We have adopted a generic form of heuristic that considers obstacles, distances, and actions the robot can perform in the workspace. It is worth mentioning that the heuristic can be customised according to the setup.
The LLMs will then work on finding the next valid &apos;moves&apos; for path planning. These moves will be assessed against the cost function, which is the combination of the path cost up to now and the heuristic from the current state. This is similar to A\*. The best &apos;move&apos; with the minimum cost will be selected and communicated to humans on request, who can assess the move and decide whether to accept or decline the move, etc.
The decision will be communicated to LLMs to carry on completing the planning. The involvement of humans&apos; guidance and assessments can help to minimise the use of tokens, which remains a challenge to use LLMs such as ChatGPT [*REF*].


LLM A\* follows a &apos;{state, action, rewards}&apos; pattern, which is similar to RL but no explicit coding is needed, and humans have full control of the planning process. To this end, we have compared it to the advanced RL algorithm PPO for performance evaluation. A quantitative comparison with A\* is also conducted. The contributions of this paper include: 1).
a first-of-its-kind LLM-based A\* is proposed for mobile robot path planning; 2). The interactive and coding-free nature makes LLA\* appealing to non-expert robotic users; 3). Improved safety assurance compared to A\* and RL as humans have full control of the planning process.


The remainder of the paper is organised as follows. Some related works are introduced in Section II. Section III elaborates on the approach.
Experiments and discussions are provided in Section IV, and the paper is concluded in Section V.


Related Work


LLM in Robotic Task Planning


Commanding robots through human language/instructions has long been a dream to robotists [*REF*; *REF*]. Before the remarkable success of LLMs, Anderson et al. [*REF*] have proposed the R2R navigation framework, where Transformers were used to achieve visually grounded natural language navigation by converting human instructions into robot action sequences. Each action will lead the robot to move from one viewpoint to another. How the path is planned between viewpoints were not elaborated and navigation errors up to 10 metres were reported.


Trained on (text) datasets of immense size, LLM models come with commonsense knowledge, which is promising to help accelerate robotic task planning [*REF*]. To the best of our knowledge, most research from literature follows the visual-linguistic grounding strategy and proposes to harness the commonsense knowledge of LLMs to build a better correspondence between human language/instructions and visual perceptions of the robots. Song et al. [*REF*] have demonstrated that LLMs can help with few-shot planning, i.e., the commonsense knowledge of LLMs is used to generate hierarchical plans, with the high-level plan being a set of viable while commonsense aligned subgoals generated by LLMs. The high-level plan is next passed to a low-level planner that is independent of the instructions to plan paths between subgoals. Other works such as [*REF*] still fall into visual-linguistic grounding but a collision check is proposed.


It is worth noting that the works mentioned above do not touch on how LLMs can be used to plan a path between subgoals or viewpoints. Aghzal et al. [*REF*] propose path planning from natural language (PPNL), with a focus on utilising LLMs in spatial-temporal path planning. However, the method is purely prompt-based, without linking and comparing it to path planning methods such as A\* and RL.


Reinforcement Learning for Robotic Planning


Reinforcement learning is another data-driven learning-based framework for path planning. In the RL framework, an agent learns a policy to select a sequence of actions that would lead the agent to efficiently move from one state to another, to eventually reach the goal. The learning process is guided by a policy that rewards good actions while penalising bad actions.


The capacity of deep learning in data representation and processing has drawn a lot of attention from the RL and robotic community. Deep learning models were then integrated into the RL framework and deep reinforcement learning (DRL) was coined [*REF*] to enable more sophisticated and effective policy learning, for robotic task planning, etc. [*REF*].


However, both RL and DRL still face the challenges of 1) low data efficiency that entails the demand for a significant number of interactions with the environment to learn the policies and the demand for large datasets for deep learning model training, and 2) the stability of convergence, i.e., RL/DRL models are not guaranteed to converge. Therefore, recent DRL models have focused on the optimisation for not only the fitness of states but also the measurement of convergence. The PPO model with actor-critic structures is one of the most renowned models. PPO is a policy gradient algorithm to maximise the horizon returns while the actor-critic structure provides a situation in which states and policy can be trained separately so that the agent achieves better planning performance and convergence [*REF*].


The prompt-driven LLM-based path planning can be considered as a variant of RL models, with rewards provided by humans through prompts and policies implicitly learned by LLMs through interactions. We therefore compare the path planning performance of LLM-based methods and RL-based methods in this paper.


The LLM A\* Approach


Agent Path Planning Formulation


For agents like mobile robots, path planning aims to find a point-to-point utility-optimal path given an environment representation, a set of valid actions, an initial state, and a goal state. To this end, the path planning problem can be formulated as a graph *MATH*, where *MATH* is a set of states that represent the environment, and *MATH* is a set of potentially valid actions that the robot can perform to traverse from one state to the other. For instance, given two states *MATH*, we can define an edge *MATH*, which indicates that the agent can move from state *MATH* to state *MATH*. The cost related to the action *MATH* can be denoted as *MATH*.


We can further define *MATH* as the initial state and the goal state. The output of path planning will be a sequence of states that form a solution path *MATH*, with *MATH*, *MATH*, and *MATH*.
The path planning is carried out by iteratively expanding from the initial state, and at each state *MATH*, the valid actions will lead to a set of states *MATH* that could be explored next. The cumulative cost of every state *MATH* is calculated and the state to explore next is the one with the minimum cost. This process iterates until the goal *MATH* is reached. For a state *MATH*, *MATH*, the cumulative cost is defined as *MATH* *MATH*. *MATH* The search process is designed as such to find a path *MATH* from *MATH* to *MATH* with a minimum total path cost.


Agent Path Planning with A\*.


A\* is one of the most popular search-based path-planning algorithms [*REF*]. On top of the cumulative cost, A\* exploits heuristics from priors or experiences to accelerate the search process.
While the cumulative cost *MATH* accounts for the real cost from the initial state *MATH* to *MATH*, a heuristic cost is defined as an &apos;estimate&apos; of the cost from *MATH* to the goal state *MATH*, and it is usually denoted as *MATH*. Considering both costs, we introduce the cost of state *MATH* in A\* as *MATH* *MATH*. *MATH* When *MATH* is admissible and consistent, A\* is guaranteed to find the optimal path. Therefore, A\* has benchmarked to assess the performance of path-planning algorithms.


FIGURE


Path Planning with Reinforcement Learning


Path planning with RL can also be formulated as a graph *MATH*. An agent will start at an initial state *MATH* and learn a policy *MATH* through constant interactions with the environment. The agent will select an action *MATH* to traverse from state *MATH* to state *MATH*, until it reaches the goal state *MATH*. For brevity and without causing ambiguity, we will omit the subscriptions below.


When the agent is in a state *MATH*, we can define a state value *MATH* that indicates the preference of the state. In general, the bigger the value, the agent will be more likely to move to this state. *MATH* is usually in the form of *MATH* *MATH* *MATH* the action evaluation function that assesses an action *MATH* that could complete the transformation from *MATH* to *MATH*, *MATH* is the transformation probability, *MATH* is the reward of the action, and *MATH* is the discount factor on state *MATH*. *MATH* is the policy to select an action from all feasible actions to complete the transformation from *MATH* to *MATH*.


The policy *MATH* is usually parameterised by a learnable variable *MATH*, and then equation can be rewritten as *MATH* *MATH*, *MATH* where *MATH* is the objective function to optimise. Schulman et al. have shown that directly optimise equation commonly causes redundant approximates and high space complexity [*REF*]. To deal with this, Schulman et al. [*REF*] propose to use an alternative objective function *MATH* *MATH* *MATH* where *MATH* *MATH* *MATH* is the advantage that describes the superiority of selecting an action *MATH* at state *MATH*, and *MATH* is the distribution of state *MATH* before updating the policy.


In this configuration given by equation, the objective is to optimise the total advantages. The PPO model uses clip techniques to avoid the dramatic change of the policy to get better optimisation convergence control [*REF*; *REF*]. In the PPO setup, equation becomes *MATH* *MATH*, *MATH* where *MATH* is the policy ratio that is clipped into *MATH* with *MATH* a small number set manually.


FIGURE


FIGURE


LLM A\* for Path Planning


LLM A\* is an LLM-based path-planning framework inspired by A\* and RL, to utilise commonsense knowledge of LLMs to achieve few-shot, code-free, and near-optimal path planning for robotics. LLMs are considered code-free implicit policy learners, that learn from environment information encoded in a graph *MATH*, and rewards from the cost function shown in equation as well as from humans that are communicated to LLMs through prompts, to achieve near-optimal path planning.


As shown in Fig., building an LLM A\* model comprises mainly two stages. The first stage is &apos;teaching&apos; an LLM to be aware of the environment the agent is in and the motions it can perform, which are encoded in a graph *MATH*. The start and target nodes *MATH*, heuristics, and any other relevant rules are also communicated to the LLM. One example of communicating such information to the LLM is given in Fig.


The second stage is the path planning stage. With the necessary information in mind, the LLM will try to plan a path between the initial state *MATH* and the goal state *MATH*. As prompts are used to communicate with the LLM, humans could be needed in the planning stage for two reasons: 1) guide the LLM only to communicate necessary information back to humans, which will save costly tokens; 2) provide guidance/heuristics when necessary to accelerate the planning process. The prompts will also enable humans to query about the planning process whenever and wherever necessary, to make the whole planning process a white box to humans.
Fig. shows how path planning is delivered by &apos;chatting&apos; with the LLM.


Experiments and Discussions


Setup


To evaluate the performance of LLM A\*, we have conducted a range of experiments to compare it to A\* and RL. For LLM A\*, we have considered two variants, i.e., 1) only consider the heuristic *MATH* as the cost function, denoted as Greedy LLM A\*; 2) consider the combination of the cumulative and heuristic costs *MATH* as the cost function, denoted as LLM A\*. The GPT3.5-turbo-16k LLM is used as it provides more tokens than GPT3.5-turbo or even GPT4. This is to ensure that we can get the planning results without disruption, not necessarily that the algorithm needs so many tokens. The GPT-3.5-turbo-16k LLM model we used allows a total of 16,384 tokens. In comparison, GPT-3.5-turbo has a maximum number of 4,096 tokens. In case there is a need to reduce the consumption of tokens to replicate the experiments, one can reset the request dictionary to null after each interaction. To enable full control/access to the planning process, one can split a single interaction process into two stages: 1) planning by LLM A\*; and 2) outputs of necessary results upon requests.


An occupancy grid map with a size *MATH* is primarily used for evaluation. There are free spaces and obstacles on the map, where a robot agent can only move in free space and needs to avoid colliding with obstacles. The agent can move in eight directions at maximum wherever and whenever it is safe. All experiments are carried out using Python 3.8+ on Google Colab.


The RL model we used is based on the PPO configuration, together with the standard A\* are used for comparison.


LLM A\* Training and Session Design


For experiments that involve LLM, there are two stages including initialization where essential information about the environment and the agent will be prompted to set up planning. The information includes 1) locations of the start and goal states; 2) obstacle distribution; 3) agent action space; 4) Chebyshev distance measurement that is used for cumulative and heuristic costs calculation; and 5) the objective to plan a path for the agent between the start and goal states. In addition, some planning rules can be communicated to LLM as well, which include 1) a viable path should avoid colliding with obstacles; 2) the path should ideally expand along the direction from heuristics or human guidance; 3) selection of the suitable actions that could accelerate the planning process.


In the second interactive planning stage, LLM can return planning results based on the initial information and other prompts to help humans guide or monitor the planning. This stage works iteratively and interactively until a path is successfully planned. It is worth noting that humans can request intermediate planning results at any stage. This makes the planning process a white box to humans, which helps to assure safety, etc.


RL Model Training


The PPO model is employed for comparison. In our case, the PPO model is based on an actor-critic structure that includes two 3-layer deep neural networks for policy and value training, respectively. The model is trained for over 8,000,000 steps (a total of more than 8,000 episodes) to ensure convergence.


On the other hand, we set the learning rates of both actor and critic to be smaller than 0.0005 to ensure that the model won&apos;t be fixed too early, achieving a balance of exploration and exploitation in contrast to the entropy penalty for convergence.


We have also randomised the start state in each episode, to improve the adaptability of the PPO model to different environments. This is achieved by proposing to use of an easy-to-difficult mechanism to train the PPO model. To be specific, we start from the states near the goal in which the agent is so close to it that ideally, it can reach the goal in one step. Next, a state will be randomly chosen from these states to train the PPO model. As the model only has a small scope of the map, it will be &apos;easy&apos; to converge. After that, the scope of the map will be increased to re-train the model until convergence. This process will iterate until the goal state is reached. As the scope of the map increases, it will become &apos;difficult&apos; for the model to converge, but with the easy-to-difficult mechanism, the model achieves a balance of adaptability to various environments while converging efficiently. After training, we subsequently ran a test episode to make the agent move from the start state toward the goal state and this will generate a path.


FIGURE


Main Results


LLM A\* will be first examined for the reduction of the search space compared to A\*. Secondly, we compare LLM A\* with both LLM Greedy and PPO in terms of path smoothness, etc. This collectively will provide an assessment of the feasibility and superiority of applying LLM in path planning.


FIGURE


Search space


Fig. shows the path planning results of A\* and LLM A\*, respectively. The red indicates the final path and the green shows the overall searched space. One can see that A\* has a bigger search space compared to LLM A\*. On top of that, LLM A\* also generates a path that agrees with humans, e.g., the path in the lower-center area goes diagonally rather than following the obstacles.
We attribute this partially to the commonsense knowledge of the LLM A\* which learns from humans, and partially to potential guidance provided by humans through interactions.


Accuracy and path smoothness


Fig. shows the comparison of the path planning results of LLM A\*, LLM Greedy, and the PPO model.


We can see that using heuristics only as the cost function or LLM Greedy has the smallest search space. This is because the greedy nature of the heuristics will always try to guide the agent to move towards the goal direction. However, the existence of obstacles will bounce the agent backward, henceforth, the agent has to go back and forth in the final path planned, making it less efficient. In contrast, LLM A\* considers both cumulative and heuristic costs, which will expand the search space, but ends up with a &apos;smoother&apos; path (less back and forth). Nevertheless, both LLM A\* and LLM Greedy outperform the RL model, either in terms of path smoothness or the search space. This demonstrates that LLM with commonsense could help improve the performance of RL models in tasks such as path planning. Fig. shows the average steps and scores against episodes for the PPO model training. We can see that the PPO model converges in 8,000 episodes and the results are generated from this model.


FIGURE


Discussion


It is undeniable that the utilisation of LLM will provoke more interactions between humans and AI agents. We have demonstrated that by combining LLM with conventional path-planning algorithms such as A\*, near-optimal path-planning results can be achieved, while still leaving humans the opportunity to scrutinise the path-planning process. This takes us one step closer to making AI techniques white boxes to humans and would contribute to safety assurance in human-robot interaction/collaboration.


It is worth noting that the form of planning a path through interaction with LLMs resembles the process of using RL in path planning, and we have demonstrated that the commonsense knowledge from LLMs can significantly improve the path planning performance, both in terms of path smoothness and search space. This will be further explored in future work.


CONCLUSIONS


This paper is the first to introduce the LLM A\*, merging Large Language Models (LLMs) and the classic A\* algorithm, to revolutionise path planning for mobile embodied agents. By harnessing the inherent commonsense of LLMs and the optimality of A\*, LLM A\* achieves few-shot near-optimal path planning compared to rivals such as RL models, while gaining the advantage of granting humans the whole access to the path planning process, which will help to ensure safety when incorporate LLM A\* in embodied agent path planning.


Despite the advantages of LLM A\*, it is just as inefficient as data-driven methods such as RL models. Future works will focus on improving the efficiency of LLM A\*, to strike a trade-off between the interactive capacity and efficiency to facilitate real-life deployment of such models.